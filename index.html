<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üå∏ Nail Sakura Studio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; touch-action: manipulation; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #FFE4E9 0%, #FFB6C1 100%); min-height: 100vh; color: #333; }
        .screen { display: none; padding: 20px; padding-bottom: 80px; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        .btn { display: block; width: 100%; padding: 18px; margin: 15px 0; background: #FFB6C1; color: white; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(216, 27, 96, 0.2); }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        .btn-secondary { background: white; color: #D81B60; border: 2px solid #FFB6C1; }
        input, select { width: 100%; padding: 16px; margin: 10px 0; border: 2px solid #FFE4E9; border-radius: 12px; font-size: 16px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-btn { flex: 1; padding: 10px; border: none; background: none; font-size: 24px; cursor: pointer; color: #888; }
        .nav-btn.active { color: #D81B60; }
        .debug { background: #000; color: #0f0; padding: 5px; font-family: monospace; font-size: 12px; margin: 5px; border-radius: 3px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="debug" id="debug">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

    <!-- –≠–ö–†–ê–ù –í–•–û–î–ê –ú–ê–°–¢–ï–†–ê -->
    <div id="masterLoginScreen" class="screen">
        <div style="text-align:center; margin:40px 0;">
            <div style="font-size:50px; margin-bottom:20px;">üîê</div>
            <h2>–í—Ö–æ–¥ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å</p>
        </div>
        <input type="password" id="masterPassword" placeholder="–ú–∞—Å—Ç–µ—Ä-–ø–∞—Ä–æ–ª—å">
        <button class="btn" onclick="loginAsMaster()">–í–æ–π—Ç–∏ –∫–∞–∫ –º–∞—Å—Ç–µ—Ä</button>
        <button class="btn btn-secondary" onclick="showScreen('main')">‚Üê –Ø –∫–ª–∏–µ–Ω—Ç</button>
    </div>

    <!-- –≠–ö–†–ê–ù 1: –ì–õ–ê–í–ù–ê–Ø -->
    <div id="mainScreen" class="screen active">
        <div style="text-align:center; margin:20px 0;">
            <div id="userAvatar" style="width:90px;height:90px;background:#FFB6C1;border-radius:50%;margin:0 auto 15px;font-size:36px;line-height:90px;">üë§</div>
            <h2 id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <p style="color:#8B475D;" id="userInfo">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...</p>
        </div>
        <button class="btn" onclick="showScreen('booking')">üíÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        <button class="btn" onclick="showScreen('services')">‚ú® –£—Å–ª—É–≥–∏</button>
        <button class="btn" onclick="showScreen('myBookings')">üìÖ –ú–æ–∏ –∑–∞–ø–∏—Å–∏</button>
        <button class="btn btn-secondary" onclick="showScreen('masterLogin')">‚öôÔ∏è –í—Ö–æ–¥ –¥–ª—è –º–∞—Å—Ç–µ—Ä–∞</button>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –ó–ê–ü–ò–°–¨ -->
    <div id="bookingScreen" class="screen">
        <button onclick="showScreen('main')" style="background:none;border:none;font-size:24px;cursor:pointer;margin-bottom:15px;">‚Üê</button>
        <h2>üìù –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
        <select id="serviceSelect">
            <option value="–ú–∞–Ω–∏–∫—é—Ä">üíÖ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä - 1500‚ÇΩ</option>
            <option value="–ì–µ–ª—å-–ª–∞–∫">‚ú® –ü–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫–æ–º - 2000‚ÇΩ</option>
            <option value="–î–∏–∑–∞–π–Ω">üé® –î–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π - 1000‚ÇΩ</option>
            <option value="SPA">üíé SPA-—É—Ö–æ–¥ - 1800‚ÇΩ</option>
        </select>
        <input type="date" id="bookingDate">
        <select id="bookingTime">
            <option>10:00</option><option>11:00</option><option>12:00</option><option>13:00</option>
            <option>14:00</option><option>15:00</option><option>16:00</option><option>17:00</option><option>18:00</option>
        </select>
        <input type="tel" id="clientPhone" placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        <button class="btn" onclick="submitBooking()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –£–°–õ–£–ì–ò -->
    <div id="servicesScreen" class="screen">
        <button onclick="showScreen('main')" style="background:none;border:none;font-size:24px;cursor:pointer;margin-bottom:15px;">‚Üê</button>
        <h2>üíÖ –ù–∞—à–∏ —É—Å–ª—É–≥–∏</h2>
        <div style="background:#FFE4E9;padding:20px;margin:15px 0;border-radius:15px;">
            <h3>üíÖ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–∞–Ω–∏–∫—é—Ä</h3><p>–û–±—Ä–∞–±–æ—Ç–∫–∞ + –ø–æ–∫—Ä—ã—Ç–∏–µ</p><strong>1500‚ÇΩ (90 –º–∏–Ω)</strong>
        </div>
        <div style="background:#FFE4E9;padding:20px;margin:15px 0;border-radius:15px;">
            <h3>‚ú® –ü–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫–æ–º</h3><p>–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ</p><strong>2000‚ÇΩ (120 –º–∏–Ω)</strong>
        </div>
        <div style="background:#FFE4E9;padding:20px;margin:15px 0;border-radius:15px;">
            <h3>üé® –î–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π</h3><p>–†–∏—Å—É–Ω–∫–∏, —Å—Ç—Ä–∞–∑—ã, –≥—Ä–∞–¥–∏–µ–Ω—Ç</p><strong>1000‚ÇΩ (60 –º–∏–Ω)</strong>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 4: –ú–û–ò –ó–ê–ü–ò–°–ò -->
    <div id="myBookingsScreen" class="screen">
        <button onclick="showScreen('main')" style="background:none;border:none;font-size:24px;cursor:pointer;margin-bottom:15px;">‚Üê</button>
        <h2>üìÖ –ú–æ–∏ –∑–∞–ø–∏—Å–∏</h2>
        <div id="bookingsList">
            <p style="text-align:center;padding:40px 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π...</p>
        </div>
        <button class="btn" onclick="loadUserBookings()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <!-- –≠–ö–†–ê–ù 5: –ü–ê–ù–ï–õ–¨ –ú–ê–°–¢–ï–†–ê -->
    <div id="masterPanelScreen" class="screen">
        <button onclick="logoutMaster()" style="background:none;border:none;font-size:24px;cursor:pointer;margin-bottom:15px;">‚Üê –í—ã–π—Ç–∏</button>
        <h2>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞</h2>
        <div style="background:#FFE4E9;padding:20px;border-radius:15px;margin:15px 0;">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: <span id="totalBookings">0</span></p>
            <p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è: <span id="todayBookings">0</span></p>
        </div>
        <div id="masterBookingList" style="max-height:300px;overflow-y:auto;">
            <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
        <button class="btn" onclick="refreshMasterPanel()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="exportToCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav" id="bottomNav">
        <button class="nav-btn active" onclick="showScreen('main')">üè†</button>
        <button class="nav-btn" onclick="showScreen('booking')">üíÖ</button>
        <button class="nav-btn" onclick="showScreen('services')">‚ú®</button>
        <button class="nav-btn" onclick="showScreen('myBookings')">üìÖ</button>
    </nav>

<script>
// ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
const MASTER_PASSWORD = "sakura2024"; // –°–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å!
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzA7ukePYKIEy0xAK4E41Vw_FHPQky9Ks0jfnlQhUw94Vsk-fTsiu1ZIiFVnaDX3anS/exec"; // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®!

// ================= –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =================
let currentUser = null;
let currentScreen = 'main';
let isMasterMode = false;

// ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM =================
function initTelegramApp() {
    if (window.Telegram && Telegram.WebApp) {
        const tg = Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#FFB6C1');
        tg.setBackgroundColor('#FFE4E9');
        tg.ready();
        
        // –ü–û–õ–£–ß–ï–ù–ò–ï –†–ï–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        const user = tg.initDataUnsafe?.user;
        if (user) {
            currentUser = {
                id: user.id,
                firstName: user.first_name,
                lastName: user.last_name || '',
                username: user.username,
                photoUrl: user.photo_url,
                isPremium: user.is_premium || false
            };
            updateDebug(`üë§ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã: ${currentUser.firstName} (ID: ${currentUser.id})`);
            updateUIWithUserData();
        } else {
            updateDebug("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!");
            currentUser = { id: 'guest', firstName: '–ì–æ—Å—Ç—å', lastName: '' };
            updateUIWithUserData();
        }
    } else {
        updateDebug("üåê –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–µ –≤ Telegram)");
        currentUser = { id: 'guest', firstName: '–ì–æ—Å—Ç—å', lastName: '' };
        updateUIWithUserData();
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('bookingDate');
    if (dateInput) {
        dateInput.value = today;
        dateInput.min = today;
    }
}

// ================= –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê =================
function updateUIWithUserData() {
    if (!currentUser) return;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    document.getElementById('userName').textContent = `–ü—Ä–∏–≤–µ—Ç, ${currentUser.firstName}!`;
    const userInfo = document.getElementById('userInfo');
    userInfo.textContent = currentUser.id !== 'guest' 
        ? `ID: ${currentUser.id}${currentUser.isPremium ? ' ‚≠ê' : ''}`
        : '–ó–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
    const avatar = document.getElementById('userAvatar');
    if (currentUser.photoUrl) {
        avatar.innerHTML = `<img src="${currentUser.photoUrl}" style="width:100%;height:100%;border-radius:50%;">`;
    } else if (currentUser.firstName) {
        avatar.textContent = currentUser.firstName[0].toUpperCase();
        avatar.style.fontSize = '36px';
        avatar.style.lineHeight = '90px';
    }
}

// ================= –ù–ê–í–ò–ì–ê–¶–ò–Ø =================
function showScreen(screenName) {
    if (screenName === 'masterLogin' && isMasterMode) {
        screenName = 'masterPanel';
    }
    
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenName + 'Screen').classList.add('active');
    currentScreen = screenName;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    if (screenName === 'main') document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
    if (screenName === 'booking') document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
    if (screenName === 'services') document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
    if (screenName === 'myBookings') document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    if (screenName === 'myBookings') loadUserBookings();
    if (screenName === 'masterPanel') refreshMasterPanel();
}

// ================= GOOGLE SHEETS –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø =================
async function saveToGoogleSheets(bookingData) {
    if (!GOOGLE_SCRIPT_URL.includes('https://script.google.com/macros/s/AKfycbzA7ukePYKIEy0xAK4E41Vw_FHPQky9Ks0jfnlQhUw94Vsk-fTsiu1ZIiFVnaDX3anS/exec')) {
        try {
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bookingData)
            });
            updateDebug("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google Sheets");
            return true;
        } catch (error) {
            updateDebug(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error}`);
            saveToLocalStorage(bookingData); // –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            return false;
        }
    } else {
        updateDebug("‚ö†Ô∏è URL —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ.");
        saveToLocalStorage(bookingData);
        return false;
    }
}

async function loadFromGoogleSheets(userId) {
    if (!GOOGLE_SCRIPT_URL.includes('YOUR_SCRIPT_ID')) {
        try {
            const url = `${GOOGLE_SCRIPT_URL}?action=getBookings&userId=${userId}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.bookings || [];
        } catch (error) {
            updateDebug(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error}`);
            return getFromLocalStorage(userId);
        }
    }
    return getFromLocalStorage(userId);
}

// ================= –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ) =================
function saveToLocalStorage(booking) {
    let bookings = JSON.parse(localStorage.getItem('nailBookings') || '[]');
    booking.id = Date.now();
    booking.timestamp = new Date().toISOString();
    bookings.push(booking);
    localStorage.setItem('nailBookings', JSON.stringify(bookings));
    updateDebug(`üíæ –õ–æ–∫–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${booking.service}`);
}

function getFromLocalStorage(userId) {
    const bookings = JSON.parse(localStorage.getItem('nailBookings') || '[]');
    if (userId === 'master') return bookings;
    return bookings.filter(b => b.userId === userId);
}

// ================= –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =================
async function submitBooking() {
    const service = document.getElementById('serviceSelect').value;
    const date = document.getElementById('bookingDate').value;
    const time = document.getElementById('bookingTime').value;
    const phone = document.getElementById('clientPhone').value;
    
    if (!date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');
        return;
    }
    
    const booking = {
        userId: currentUser.id,
        userName: `${currentUser.firstName} ${currentUser.lastName}`.trim(),
        userInfo: currentUser.username ? `@${currentUser.username}` : `ID: ${currentUser.id}`,
        service: service,
        date: date,
        time: time,
        phone: phone || '–ù–µ —É–∫–∞–∑–∞–Ω',
        status: 'pending',
        timestamp: new Date().toISOString()
    };
    
    updateDebug(`üìù –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏: ${service} –Ω–∞ ${date} ${time}`);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets
    const saved = await saveToGoogleSheets(booking);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    alert(saved 
        ? `üéâ –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞!\n${service}\n${date} –≤ ${time}\nID: ${booking.userId}`
        : `üéâ –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)!\n${service}\n${date} –≤ ${time}`
    );
    
    showScreen('main');
}

async function loadUserBookings() {
    const container = document.getElementById('bookingsList');
    container.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
    
    const bookings = await loadFromGoogleSheets(currentUser.id);
    
    if (bookings.length === 0) {
        container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>';
        return;
    }
    
    container.innerHTML = bookings.map(b => `
        <div style="background:${b.status === 'confirmed' ? '#E8F5E9' : '#FFF3E0'};padding:15px;margin:10px 0;border-radius:12px;border-left:4px solid ${b.status === 'confirmed' ? '#4CAF50' : '#FF9800'};">
            <strong>${b.service}</strong><br>
            <small>üìÖ ${b.date} üïê ${b.time}</small><br>
            <em>–°—Ç–∞—Ç—É—Å: ${b.status === 'confirmed' ? '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' : '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}</em>
        </div>
    `).join('');
}

// ================= –§–£–ù–ö–¶–ò–ò –ú–ê–°–¢–ï–†–ê =================
function loginAsMaster() {
    const password = document.getElementById('masterPassword').value;
    if (password === MASTER_PASSWORD) {
        isMasterMode = true;
        updateDebug("üîì –í—Ö–æ–¥ –º–∞—Å—Ç–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω");
        document.getElementById('masterPassword').value = '';
        showScreen('masterPanel');
    } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
    }
}

function logoutMaster() {
    isMasterMode = false;
    updateDebug("üîí –í—ã—Ö–æ–¥ –º–∞—Å—Ç–µ—Ä–∞");
    showScreen('main');
}

async function refreshMasterPanel() {
    const bookings = await loadFromGoogleSheets('master');
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    const today = new Date().toISOString().split('T')[0];
    const todayBookings = bookings.filter(b => b.date === today);
    
    document.getElementById('totalBookings').textContent = bookings.length;
    document.getElementById('todayBookings').textContent = todayBookings.length;
    
    // –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
    const container = document.getElementById('masterBookingList');
    if (bookings.length === 0) {
        container.innerHTML = '<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>';
        return;
    }
    
    container.innerHTML = bookings.slice(-10).reverse().map(b => `
        <div style="background:#f5f5f5;padding:12px;margin:8px 0;border-radius:10px;font-size:14px;">
            <strong>${b.service}</strong> | ${b.date} ${b.time}<br>
            <small>üë§ ${b.userName} (${b.userInfo})</small><br>
            <small>üìû ${b.phone} | –°—Ç–∞—Ç—É—Å: <span style="color:${b.status === 'confirmed' ? 'green' : 'orange'}">${b.status}</span></small>
        </div>
    `).join('');
}

function exportToCSV() {
    const bookings = JSON.parse(localStorage.getItem('nailBookings') || '[]');
    if (bookings.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
    }
    
    let csv = 'ID,–ö–ª–∏–µ–Ω—Ç,–£—Å–ª—É–≥–∞,–î–∞—Ç–∞,–í—Ä–µ–º—è,–¢–µ–ª–µ—Ñ–æ–Ω,–°—Ç–∞—Ç—É—Å\n';
    bookings.forEach(b => {
        csv += `${b.id},${b.userName},${b.service},${b.date},${b.time},${b.phone},${b.status}\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bookings_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    updateDebug("üì• CSV —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω");
}

// ================= –£–¢–ò–õ–ò–¢–´ =================
function updateDebug(message) {
    console.log(message);
    document.getElementById('debug').textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
}

// ================= –ó–ê–ü–£–°–ö =================
document.addEventListener('DOMContentLoaded', function() {
    initTelegramApp();
    updateDebug("üå∏ Nail Sakura Studio –∑–∞–≥—Ä—É–∂–µ–Ω");
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É –∫–ª–∏–∫–æ–≤
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON') {
            updateDebug(`üñ±Ô∏è –ö–ª–∏–∫: ${e.target.textContent}`);
        }
    });
});
</script>
</body>
</html>


